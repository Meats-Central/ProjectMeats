{
  "name": "ProjectMeats Dev Container",
  "image": "ghcr.io/meats-central/projectmeats-backend:dev-latest",  // Use the backend image from GHCR
  "service": "backend",  // Start with the backend service
  "workspaceFolder": "/app",  // Use /app as the workspace folder inside the container

  "customizations": {
    "vscode": {
      "extensions": [
        "github.copilot",
        "ms-azuretools.vscode-docker",
        "ms-python.python"  // Python extension for Django
      ]
    }
  },

  "postCreateCommand": "echo 'Dev container setup completed!' && pip install -r requirements.txt",  // Install dependencies after container setup

  "forwardPorts": [8000, 8080],  // Forward necessary ports for frontend and backend

  "settings": {
    "terminal.integrated.shell.linux": "/bin/bash",  // Set terminal shell to bash
    "editor.formatOnSave": true,  // Automatically format code on save
    "python.pythonPath": "/usr/local/bin/python3.12"  // Ensure the correct Python interpreter is selected
  },

  "mounts": [
    "source=/mnt/data/tenant_onboarding,target=/app/tenant_onboarding,type=bind"  // Mount additional volumes if required
  ],

  "runArgs": [
    "--env", "DJANGO_SETTINGS_MODULE=${{ secrets.DEV_DJANGO_SETTINGS_MODULE }}",  // Pass secrets via GitHub actions
    "--env", "SECRET_KEY=${{ secrets.DEV_SECRET_KEY }}",
    "--env", "CORS_ALLOWED_ORIGINS=${{ secrets.DEV_CORS_ALLOWED_ORIGINS }}",
    "--env", "DATABASE_URL=${{ secrets.DEV_DATABASE_URL }}",
    "--env", "ALLOWED_HOSTS=${{ secrets.DEV_ALLOWED_HOSTS }}",
    "--env", "LOG_LEVEL=${{ secrets.LOG_LEVEL }}",
    "--env", "DB_ENGINE=${{ secrets.DEV_DB_ENGINE }}",
    "--env", "DB_NAME=${{ secrets.DEV_DB_NAME }}",
    "--env", "DB_USER=${{ secrets.DEV_DB_USER }}",
    "--env", "DB_PASSWORD=${{ secrets.DEV_DB_PASSWORD }}",
    "--env", "DB_HOST=${{ secrets.DEV_DB_HOST }}",
    "--env", "DB_PORT=${{ secrets.DEV_DB_PORT }}",
    "--env", "CORS_ALLOW_ALL_ORIGINS=${{ secrets.CORS_ALLOW_ALL_ORIGINS }}",
    "--env", "SESSION_COOKIE_SECURE=${{ secrets.SESSION_COOKIE_SECURE }}",
    "--env", "CSRF_COOKIE_SECURE=${{ secrets.CSRF_COOKIE_SECURE }}",
    "--env", "OPENAI_API_KEY=${{ secrets.DEV_OPENAI_API_KEY }}",
    "--env", "EMAIL_BACKEND=${{ secrets.DEV_EMAIL_BACKEND }}",
    "--env", "EMAIL_HOST=${{ secrets.DEV_EMAIL_HOST }}",
    "--env", "EMAIL_PORT=${{ secrets.DEV_EMAIL_PORT }}",
    "--env", "EMAIL_USE_TLS=${{ secrets.DEV_EMAIL_USE_TLS }}",
    "--env", "EMAIL_HOST_USER=${{ secrets.DEV_EMAIL_HOST_USER }}",
    "--env", "EMAIL_HOST_PASSWORD=${{ secrets.DEV_EMAIL_HOST_PASSWORD }}"
  ],

  "features": {
    "python": "latest",  // Ensure Python is available
    "docker": "latest"   // Ensure Docker is available
  },

  "postAttachCommand": "python /app/manage.py migrate && python /app/manage.py runserver",  // Run Django commands when container is attached
  "remoteUser": "appuser",  // Use appuser (non-root) inside the container
  "extensions": [
    "ms-python.python",  // Install Python extension in VSCode
    "dbaeumer.vscode-eslint"  // If linting is required in the frontend
  ]
}
