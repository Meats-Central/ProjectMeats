# build
FROM node:20 as build
WORKDIR /web
COPY frontend/package*.json ./
RUN npm ci
COPY frontend/ ./
RUN npm run build

# serve
FROM nginx:1.27-alpine
COPY --from=build /web/build /usr/share/nginx/html
# Basic health endpoint
RUN printf 'server { listen 3000; location /healthz { return 200; } location / { root /usr/share/nginx/html; try_files $uri /index.html; } }' > /etc/nginx/conf.d/default.conf
EXPOSE 3000
