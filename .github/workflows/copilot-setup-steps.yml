name: "Copilot Setup Steps"

on:
  issues:
    types:
      - assigned

jobs:
  copilot-setup-steps:
    runs-on: ubuntu-latest
    environment:
      name: copilot

    permissions:
      contents: read
      packages: read

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker
        uses: docker/setup-buildx-action@v2

      # Pull backend and frontend images from GHCR
      - name: Pull Backend Image
        run: |
          docker pull ghcr.io/meats-central/projectmeats-backend:dev-latest

      - name: Pull Frontend Image
        run: |
          docker pull ghcr.io/meats-central/projectmeats-frontend:dev-latest

      # Run commands inside the backend container for Copilot
      - name: Run Backend Container for Copilot
        run: |
          docker run --rm ghcr.io/meats-central/projectmeats-backend:dev-latest \
            bash -c "echo 'Running backend container for Copilot'; python --version; django-admin --version"

      # Run commands inside the frontend container for Copilot
      - name: Run Frontend Container for Copilot
        run: |
          docker run --rm ghcr.io/meats-central/projectmeats-frontend:dev-latest \
            bash -c "echo 'Running frontend container for Copilot'; npm --version"
