name: Copilot Setup Steps

on:
  workflow_dispatch:

jobs:
  # CRITICAL: This job ID must be exactly 'copilot-setup-steps'
  # Do not change this to 'setup', 'build', or anything else.
  copilot-setup-steps:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      # 1. Backend Setup (Python)
      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip' # Caches dependencies for speed

      - name: Install Backend Dependencies
        run: |
          pip install -r backend/requirements.txt
          # If you have a dev-requirements.txt, install it here too
          # pip install -r backend/requirements-dev.txt || true

      # 2. Frontend Setup (Node.js)
      - name: Set up Node.js 20
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: frontend/package-lock.json

      - name: Install Frontend Dependencies
        run: |
          cd frontend
          npm ci # 'ci' is faster and safer than 'install' for CI environments

      # 3. (Optional) Database Client
      # Useful if the agent needs to run DB commands during tasks
      - name: Install PostgreSQL Client
        run: |
          sudo apt-get update
          sudo apt-get install -y postgresql-client
